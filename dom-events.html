<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VWO QA ‚Äì DOM Events</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>

    <nav class="site-nav">
        <span class="nav-brand">üß™ VWO QA Site</span>
        <a href="index.html">Home</a>
        <a href="forms.html">Forms</a>
        <a href="dynamic-forms.html">Dynamic Forms</a>
        <a href="custom-elements.html">Custom Elements</a>
        <a href="shadow-dom.html">Shadow DOM</a>
        <a href="canvas.html">Canvas</a>
        <a href="tables.html">Tables</a>
        <a href="media.html">Media</a>
        <a href="interactive.html">Interactive</a>
        <a href="dom-events.html">DOM Events</a>
        <a href="storage.html">Storage</a>
        <a href="ajax.html">AJAX</a>
        <a href="accessibility.html">Accessibility</a>
    </nav>

    <div class="page-header">
        <h1>DOM Events</h1>
        <p>Click, keyboard, mouse, scroll, pointer, focus, mutation observer, and custom events.</p>
    </div>

    <main class="content">

        <!-- Click Events -->
        <div class="section">
            <h2>Click Events</h2>
            <div class="grid-2">
                <div>
                    <div class="btn-group" style="flex-direction:column;align-items:flex-start">
                        <button class="btn btn-primary" id="btn-click" data-testid="btn-click">Single Click</button>
                        <button class="btn btn-secondary" id="btn-dblclick" data-testid="btn-dblclick">Double
                            Click</button>
                        <button class="btn btn-warning" id="btn-rightclick" data-testid="btn-rightclick">Right Click
                            (contextmenu)</button>
                        <button class="btn btn-success" id="btn-longpress" data-testid="btn-longpress">Long Press (hold
                            1s)</button>
                    </div>
                </div>
                <div>
                    <div class="output-box" id="click-events-log" style="height:160px">Click the buttons to see events‚Ä¶
                    </div>
                </div>
            </div>
            <div class="mt-16">
                <h3>Click Counter</h3>
                <div class="flex gap-16 items-center flex-wrap">
                    <button class="btn btn-primary" id="counter-btn" data-testid="counter-btn">Click Me!</button>
                    <span style="font-size:24px;font-weight:bold" id="click-count">0</span>
                    <span style="font-size:14px;color:var(--text-muted)">clicks</span>
                    <button class="btn btn-secondary btn-sm"
                        onclick="document.getElementById('click-count').textContent='0'">Reset</button>
                </div>
            </div>
        </div>

        <!-- Keyboard Events -->
        <div class="section">
            <h2>Keyboard Events</h2>
            <div class="form-group">
                <label for="keyboard-input">Type here to capture keyboard events:</label>
                <input type="text" id="keyboard-input" placeholder="Focus and type‚Ä¶" data-testid="keyboard-input"
                    style="font-size:16px">
            </div>
            <div class="grid-2">
                <div>
                    <h3>Key Display</h3>
                    <div id="key-display"
                        style="background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);padding:16px;text-align:center;min-height:80px">
                        <div style="font-size:32px;font-weight:bold" id="key-char">‚Äî</div>
                        <div style="font-size:12px;color:var(--text-muted)" id="key-info">Press a key</div>
                    </div>
                </div>
                <div>
                    <div class="output-box" id="keyboard-log" style="height:120px">Keyboard events will appear here‚Ä¶
                    </div>
                </div>
            </div>
            <div class="mt-16">
                <h3>Keyboard Shortcuts</h3>
                <p class="text-sm text-muted">Try: <kbd>Ctrl+S</kbd> (save), <kbd>Ctrl+Z</kbd> (undo), <kbd>Escape</kbd>
                    (clear), <kbd>Enter</kbd> (submit)</p>
                <div id="shortcut-log" class="output-box mt-8" style="min-height:40px"></div>
            </div>
        </div>

        <!-- Mouse Events -->
        <div class="section">
            <h2>Mouse Events</h2>
            <div class="grid-2">
                <div>
                    <div id="mouse-zone"
                        style="background:var(--bg);border:2px solid var(--border);border-radius:var(--radius);height:180px;display:flex;align-items:center;justify-content:center;font-size:14px;color:var(--text-muted);cursor:crosshair;position:relative;overflow:hidden"
                        data-testid="mouse-zone">
                        Move mouse here
                        <div id="mouse-cursor-dot"
                            style="position:absolute;width:10px;height:10px;border-radius:50%;background:var(--primary);pointer-events:none;transform:translate(-50%,-50%);display:none">
                        </div>
                    </div>
                    <div id="mouse-coords" class="form-hint mt-8">X: ‚Äî Y: ‚Äî</div>
                </div>
                <div>
                    <div class="output-box" id="mouse-events-log" style="height:200px">Mouse events will appear here‚Ä¶
                    </div>
                </div>
            </div>
        </div>

        <!-- Scroll Events -->
        <div class="section">
            <h2>Scroll Events &amp; Intersection Observer</h2>
            <div class="grid-2">
                <div>
                    <div id="scroll-box"
                        style="height:200px;overflow-y:auto;border:1px solid var(--border);border-radius:var(--radius);padding:12px"
                        data-testid="scroll-box">
                        <div
                            style="height:600px;background:linear-gradient(to bottom,#dbeafe,#eff6ff);border-radius:4px;display:flex;flex-direction:column;justify-content:space-between;padding:12px">
                            <span style="font-size:13px;color:#1d4ed8">‚¨Ü Top of scroll area</span>
                            <span style="font-size:13px;color:#1d4ed8;text-align:center">Middle</span>
                            <span style="font-size:13px;color:#1d4ed8;text-align:right">‚¨á Bottom</span>
                        </div>
                    </div>
                    <div id="scroll-info" class="form-hint mt-8">Scroll position: 0px</div>
                </div>
                <div>
                    <h3>Intersection Observer</h3>
                    <div style="height:200px;overflow-y:auto;border:1px solid var(--border);border-radius:var(--radius);padding:12px"
                        id="io-container" data-testid="io-container">
                        <div
                            style="height:100px;background:var(--bg);border-radius:4px;margin-bottom:8px;display:flex;align-items:center;justify-content:center;font-size:13px">
                            Scroll down ‚Üì</div>
                        <div id="io-target"
                            style="height:60px;background:#dbeafe;border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:13px;color:#1d4ed8;transition:background 0.3s"
                            data-testid="io-target">
                            üëÅÔ∏è I'm being observed!
                        </div>
                        <div
                            style="height:100px;background:var(--bg);border-radius:4px;margin-top:8px;display:flex;align-items:center;justify-content:center;font-size:13px">
                            More content below</div>
                    </div>
                    <div id="io-status" class="form-hint mt-8">Not yet visible</div>
                </div>
            </div>
        </div>

        <!-- Pointer Events -->
        <div class="section">
            <h2>Pointer Events</h2>
            <div id="pointer-zone"
                style="background:var(--bg);border:2px solid var(--border);border-radius:var(--radius);height:150px;display:flex;align-items:center;justify-content:center;font-size:14px;color:var(--text-muted);touch-action:none"
                data-testid="pointer-zone">
                Touch or click here (pointer events)
            </div>
            <div class="output-box mt-8" id="pointer-log" style="min-height:60px"></div>
        </div>

        <!-- Focus / Blur Events -->
        <div class="section">
            <h2>Focus &amp; Blur Events</h2>
            <div class="form-row">
                <div class="form-group">
                    <label for="focus-input-1">Field 1 (tab through)</label>
                    <input type="text" id="focus-input-1" placeholder="Click or tab here" data-testid="focus-input-1">
                </div>
                <div class="form-group">
                    <label for="focus-input-2">Field 2</label>
                    <input type="text" id="focus-input-2" placeholder="Then tab here" data-testid="focus-input-2">
                </div>
                <div class="form-group">
                    <label for="focus-input-3">Field 3</label>
                    <input type="text" id="focus-input-3" placeholder="Then here" data-testid="focus-input-3">
                </div>
            </div>
            <div class="output-box" id="focus-log" style="min-height:60px"></div>
        </div>

        <!-- Mutation Observer -->
        <div class="section">
            <h2>Mutation Observer</h2>
            <p class="text-sm text-muted" style="margin-bottom:10px">A MutationObserver watches the container below for
                DOM changes.</p>
            <div class="btn-group" style="margin-bottom:10px">
                <button class="btn btn-primary btn-sm" onclick="mutAddChild()">Add Child</button>
                <button class="btn btn-danger btn-sm" onclick="mutRemoveChild()">Remove Child</button>
                <button class="btn btn-secondary btn-sm" onclick="mutChangeAttr()">Change Attribute</button>
                <button class="btn btn-warning btn-sm" onclick="mutChangeText()">Change Text</button>
            </div>
            <div id="mutation-target"
                style="background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);padding:12px;min-height:60px"
                data-testid="mutation-target" data-custom-attr="initial">
                <span id="mutation-text">Original text content</span>
            </div>
            <div class="output-box mt-8" id="mutation-log" style="min-height:80px"></div>
        </div>

        <!-- Custom Events -->
        <div class="section">
            <h2>Custom Events (dispatchEvent)</h2>
            <div class="btn-group">
                <button class="btn btn-primary" id="dispatch-btn-1"
                    onclick="fireCustomEvent('vwo:pageview', { page: '/home', user: 'test-user' })">Fire
                    vwo:pageview</button>
                <button class="btn btn-success" id="dispatch-btn-2"
                    onclick="fireCustomEvent('vwo:conversion', { goal: 'signup', value: 99 })">Fire
                    vwo:conversion</button>
                <button class="btn btn-warning" id="dispatch-btn-3"
                    onclick="fireCustomEvent('vwo:experiment', { id: 'exp-123', variant: 'B' })">Fire
                    vwo:experiment</button>
            </div>
            <div class="output-box mt-8" id="custom-event-log" style="min-height:60px"></div>
        </div>

        <!-- Event Delegation -->
        <div class="section">
            <h2>Event Delegation</h2>
            <p class="text-sm text-muted" style="margin-bottom:10px">One listener on the parent handles clicks on all
                children (including dynamically added ones).</p>
            <div id="delegation-parent"
                style="background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);padding:12px"
                data-testid="delegation-parent">
                <button class="btn btn-secondary btn-sm" data-action="view" data-id="1">View #1</button>
                <button class="btn btn-secondary btn-sm" data-action="edit" data-id="1">Edit #1</button>
                <button class="btn btn-danger btn-sm" data-action="delete" data-id="1">Delete #1</button>
            </div>
            <div class="btn-group mt-8">
                <button class="btn btn-secondary btn-sm" onclick="addDelegatedButtons()">+ Add More Buttons</button>
            </div>
            <div class="output-box mt-8" id="delegation-log" style="min-height:60px"></div>
        </div>

    </main>

    <script src="main.js"></script>
    <script>
        // ===== Click Events =====
        let clickCount = 0;
        document.getElementById('btn-click').addEventListener('click', () => logToBox('click-events-log', 'click event fired', 'success'));
        document.getElementById('btn-dblclick').addEventListener('dblclick', () => logToBox('click-events-log', 'dblclick event fired', 'success'));
        document.getElementById('btn-rightclick').addEventListener('contextmenu', e => { e.preventDefault(); logToBox('click-events-log', 'contextmenu event fired', 'info'); });

        let longPressTimer;
        const longPressBtn = document.getElementById('btn-longpress');
        longPressBtn.addEventListener('mousedown', () => {
            longPressTimer = setTimeout(() => logToBox('click-events-log', 'Long press detected (1000ms)!', 'success'), 1000);
        });
        longPressBtn.addEventListener('mouseup', () => clearTimeout(longPressTimer));
        longPressBtn.addEventListener('mouseleave', () => clearTimeout(longPressTimer));

        document.getElementById('counter-btn').addEventListener('click', () => {
            clickCount++;
            document.getElementById('click-count').textContent = clickCount;
        });

        // ===== Keyboard Events =====
        const keyInput = document.getElementById('keyboard-input');
        keyInput.addEventListener('keydown', e => {
            document.getElementById('key-char').textContent = e.key === ' ' ? 'Space' : e.key;
            document.getElementById('key-info').textContent = `Code: ${e.code} | keyCode: ${e.keyCode} | Ctrl: ${e.ctrlKey} | Shift: ${e.shiftKey}`;
            logToBox('keyboard-log', `keydown: "${e.key}" (${e.code})`, 'info');
        });
        keyInput.addEventListener('keyup', e => logToBox('keyboard-log', `keyup: "${e.key}"`, ''));
        keyInput.addEventListener('input', e => logToBox('keyboard-log', `input: value="${e.target.value}"`, 'success'));

        document.addEventListener('keydown', e => {
            if (e.ctrlKey && e.key === 's') { e.preventDefault(); logToBox('shortcut-log', 'Ctrl+S: Save triggered', 'success'); }
            if (e.ctrlKey && e.key === 'z') { e.preventDefault(); logToBox('shortcut-log', 'Ctrl+Z: Undo triggered', 'info'); }
            if (e.key === 'Escape') { logToBox('shortcut-log', 'Escape: Clear/Cancel triggered', 'info'); }
            if (e.key === 'Enter' && e.target === keyInput) { logToBox('shortcut-log', 'Enter: Submit triggered', 'success'); }
        });

        // ===== Mouse Events =====
        const mouseZone = document.getElementById('mouse-zone');
        const dot = document.getElementById('mouse-cursor-dot');
        mouseZone.addEventListener('mousemove', e => {
            const rect = mouseZone.getBoundingClientRect();
            const x = Math.round(e.clientX - rect.left), y = Math.round(e.clientY - rect.top);
            dot.style.display = 'block'; dot.style.left = x + 'px'; dot.style.top = y + 'px';
            document.getElementById('mouse-coords').textContent = `X: ${x} Y: ${y} | Buttons: ${e.buttons}`;
        });
        mouseZone.addEventListener('mouseenter', () => logToBox('mouse-events-log', 'mouseenter', 'info'));
        mouseZone.addEventListener('mouseleave', () => { dot.style.display = 'none'; logToBox('mouse-events-log', 'mouseleave', 'info'); });
        mouseZone.addEventListener('click', e => logToBox('mouse-events-log', `click at (${Math.round(e.offsetX)}, ${Math.round(e.offsetY)})`, 'success'));
        mouseZone.addEventListener('mousedown', e => logToBox('mouse-events-log', `mousedown button:${e.button}`, ''));
        mouseZone.addEventListener('mouseup', e => logToBox('mouse-events-log', `mouseup button:${e.button}`, ''));

        // ===== Scroll Events =====
        document.getElementById('scroll-box').addEventListener('scroll', function () {
            document.getElementById('scroll-info').textContent = `Scroll position: ${Math.round(this.scrollTop)}px / ${this.scrollHeight - this.clientHeight}px`;
        });

        const ioObserver = new IntersectionObserver(entries => {
            const entry = entries[0];
            const target = document.getElementById('io-target');
            const status = document.getElementById('io-status');
            if (entry.isIntersecting) {
                target.style.background = '#dcfce7'; target.style.color = '#15803d';
                status.textContent = `‚úÖ Visible! (ratio: ${entry.intersectionRatio.toFixed(2)})`;
            } else {
                target.style.background = '#dbeafe'; target.style.color = '#1d4ed8';
                status.textContent = '‚ùå Not visible';
            }
        }, { root: document.getElementById('io-container'), threshold: [0, 0.5, 1] });
        ioObserver.observe(document.getElementById('io-target'));

        // ===== Pointer Events =====
        const pZone = document.getElementById('pointer-zone');
        ['pointerdown', 'pointerup', 'pointermove', 'pointerenter', 'pointerleave'].forEach(evt => {
            pZone.addEventListener(evt, e => {
                if (evt === 'pointermove') return; // too noisy
                logToBox('pointer-log', `${evt}: type=${e.pointerType} id=${e.pointerId} pressure=${e.pressure.toFixed(2)}`, 'info');
            });
        });

        // ===== Focus / Blur =====
        ['focus-input-1', 'focus-input-2', 'focus-input-3'].forEach(id => {
            const el = document.getElementById(id);
            el.addEventListener('focus', () => logToBox('focus-log', `focus: #${id}`, 'success'));
            el.addEventListener('blur', () => logToBox('focus-log', `blur: #${id}`, 'info'));
            el.addEventListener('change', e => logToBox('focus-log', `change: #${id} = "${e.target.value}"`, 'success'));
        });

        // ===== Mutation Observer =====
        let mutChildCount = 0;
        const mutObserver = new MutationObserver(mutations => {
            mutations.forEach(m => {
                if (m.type === 'childList') {
                    m.addedNodes.forEach(n => { if (n.nodeType === 1) logToBox('mutation-log', `childList: added <${n.tagName.toLowerCase()}>`, 'success'); });
                    m.removedNodes.forEach(n => { if (n.nodeType === 1) logToBox('mutation-log', `childList: removed <${n.tagName.toLowerCase()}>`, 'info'); });
                }
                if (m.type === 'attributes') logToBox('mutation-log', `attributes: "${m.attributeName}" changed to "${m.target.getAttribute(m.attributeName)}"`, 'info');
                if (m.type === 'characterData') logToBox('mutation-log', `characterData: text changed`, 'success');
            });
        });
        mutObserver.observe(document.getElementById('mutation-target'), { childList: true, attributes: true, subtree: true, characterData: true });

        function mutAddChild() {
            mutChildCount++;
            const el = document.createElement('div');
            el.id = 'mut-child-' + mutChildCount;
            el.style.cssText = 'background:#dbeafe;padding:4px 8px;border-radius:4px;font-size:12px;margin-top:6px;display:inline-block';
            el.textContent = 'Child ' + mutChildCount;
            document.getElementById('mutation-target').appendChild(el);
        }
        function mutRemoveChild() {
            const target = document.getElementById('mutation-target');
            const children = target.querySelectorAll('[id^="mut-child-"]');
            if (children.length) target.removeChild(children[children.length - 1]);
        }
        function mutChangeAttr() {
            const target = document.getElementById('mutation-target');
            target.setAttribute('data-custom-attr', 'changed-' + Date.now());
        }
        function mutChangeText() {
            document.getElementById('mutation-text').textContent = 'Text changed at ' + new Date().toLocaleTimeString();
        }

        // ===== Custom Events =====
        function fireCustomEvent(name, detail) {
            const event = new CustomEvent(name, { detail, bubbles: true, cancelable: true });
            document.dispatchEvent(event);
            logToBox('custom-event-log', `Fired: ${name} | ${JSON.stringify(detail)}`, 'success');
        }
        document.addEventListener('vwo:pageview', e => logToBox('custom-event-log', `Received vwo:pageview: ${JSON.stringify(e.detail)}`, 'info'));
        document.addEventListener('vwo:conversion', e => logToBox('custom-event-log', `Received vwo:conversion: ${JSON.stringify(e.detail)}`, 'info'));
        document.addEventListener('vwo:experiment', e => logToBox('custom-event-log', `Received vwo:experiment: ${JSON.stringify(e.detail)}`, 'info'));

        // ===== Event Delegation =====
        let delegationCount = 1;
        document.getElementById('delegation-parent').addEventListener('click', function (e) {
            const btn = e.target.closest('[data-action]');
            if (!btn) return;
            logToBox('delegation-log', `Action: "${btn.dataset.action}" on ID: ${btn.dataset.id}`, 'success');
        });

        function addDelegatedButtons() {
            delegationCount++;
            const parent = document.getElementById('delegation-parent');
            ['view', 'edit', 'delete'].forEach(action => {
                const btn = document.createElement('button');
                btn.className = 'btn btn-' + (action === 'delete' ? 'danger' : 'secondary') + ' btn-sm';
                btn.dataset.action = action; btn.dataset.id = delegationCount;
                btn.textContent = `${action.charAt(0).toUpperCase() + action.slice(1)} #${delegationCount}`;
                parent.appendChild(btn);
            });
        }
    </script>
</body>

</html>