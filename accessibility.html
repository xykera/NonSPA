<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VWO QA ‚Äì Accessibility</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--primary);
            color: #fff;
            padding: 8px 16px;
            z-index: 9999;
            border-radius: 0 0 4px 0;
            font-size: 14px;
            transition: top 0.2s;
        }

        .skip-link:focus {
            top: 0;
        }

        .focus-trap-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .focus-trap-overlay.open {
            display: flex;
        }

        .focus-trap-box {
            background: var(--surface);
            border-radius: 8px;
            padding: 24px;
            max-width: 400px;
            width: 90%;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .keyboard-nav-item:focus {
            outline: 3px solid var(--primary);
            outline-offset: 2px;
        }

        [aria-expanded="false"]+.collapsible {
            display: none;
        }

        [aria-expanded="true"]+.collapsible {
            display: block;
        }

        .live-region-demo {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 12px;
            min-height: 40px;
            font-size: 14px;
        }

        .high-contrast {
            background: #000 !important;
            color: #fff !important;
            border-color: #fff !important;
        }

        .high-contrast .section {
            background: #111;
            border-color: #555;
        }

        .high-contrast h2 {
            color: #fff;
        }
    </style>
</head>

<body>

    <!-- Skip Navigation Link -->
    <a href="#main-content" class="skip-link" id="skip-nav">Skip to main content</a>

    <nav class="site-nav" role="navigation" aria-label="Main navigation">
        <span class="nav-brand">üß™ VWO QA Site</span>
        <a href="index.html">Home</a>
        <a href="forms.html">Forms</a>
        <a href="dynamic-forms.html">Dynamic Forms</a>
        <a href="custom-elements.html">Custom Elements</a>
        <a href="shadow-dom.html">Shadow DOM</a>
        <a href="canvas.html">Canvas</a>
        <a href="tables.html">Tables</a>
        <a href="media.html">Media</a>
        <a href="interactive.html">Interactive</a>
        <a href="dom-events.html">DOM Events</a>
        <a href="storage.html">Storage</a>
        <a href="ajax.html">AJAX</a>
        <a href="accessibility.html">Accessibility</a>
    </nav>

    <div class="page-header" role="banner">
        <h1>Accessibility (A11y)</h1>
        <p>ARIA roles, landmarks, live regions, focus management, keyboard navigation, and screen reader support.</p>
    </div>

    <main class="content" id="main-content" role="main">

        <!-- ARIA Landmarks -->
        <div class="section" aria-labelledby="landmarks-heading">
            <h2 id="landmarks-heading">ARIA Landmarks</h2>
            <p class="text-sm text-muted" style="margin-bottom:12px">Landmark roles help screen readers navigate the
                page structure.</p>
            <div class="grid-2">
                <div>
                    <h3>Landmark Roles Present on This Page</h3>
                    <ul style="font-size:14px;margin-left:20px;line-height:2">
                        <li><code>role="navigation"</code> ‚Äî Site nav</li>
                        <li><code>role="banner"</code> ‚Äî Page header</li>
                        <li><code>role="main"</code> ‚Äî Main content</li>
                        <li><code>role="complementary"</code> ‚Äî Aside (below)</li>
                        <li><code>role="contentinfo"</code> ‚Äî Footer</li>
                        <li><code>role="search"</code> ‚Äî Search form</li>
                        <li><code>role="form"</code> ‚Äî Contact form</li>
                    </ul>
                </div>
                <div>
                    <aside role="complementary" aria-label="Quick stats"
                        style="background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);padding:14px">
                        <h3 style="font-size:14px;margin-bottom:8px">Quick Stats (complementary)</h3>
                        <dl style="font-size:13px">
                            <dt style="font-weight:600">Pages</dt>
                            <dd style="margin-left:12px;color:var(--text-muted)">13</dd>
                            <dt style="font-weight:600">Elements</dt>
                            <dd style="margin-left:12px;color:var(--text-muted)">200+</dd>
                            <dt style="font-weight:600">Web Components</dt>
                            <dd style="margin-left:12px;color:var(--text-muted)">5</dd>
                        </dl>
                    </aside>
                </div>
            </div>
        </div>

        <!-- ARIA Roles -->
        <div class="section" aria-labelledby="aria-roles-heading">
            <h2 id="aria-roles-heading">ARIA Roles</h2>
            <div class="grid-2">
                <div>
                    <h3>Widget Roles</h3>
                    <div style="display:flex;flex-direction:column;gap:8px;font-size:14px">
                        <div role="button" tabindex="0" id="aria-btn" class="keyboard-nav-item"
                            style="background:var(--primary);color:#fff;padding:8px 14px;border-radius:var(--radius);cursor:pointer;display:inline-block;width:fit-content"
                            aria-pressed="false" data-testid="aria-button" onclick="toggleAriaBtn(this)"
                            onkeydown="if(event.key==='Enter'||event.key===' ')toggleAriaBtn(this)">
                            Toggle Button (role=button)
                        </div>
                        <div role="checkbox" tabindex="0" id="aria-checkbox" class="keyboard-nav-item"
                            aria-checked="false" style="cursor:pointer;display:flex;align-items:center;gap:8px"
                            data-testid="aria-checkbox" onclick="toggleAriaCheckbox(this)"
                            onkeydown="if(event.key===' ')toggleAriaCheckbox(this)">
                            <span
                                style="width:18px;height:18px;border:2px solid var(--border);border-radius:3px;display:inline-flex;align-items:center;justify-content:center"
                                id="aria-checkbox-icon"></span>
                            Custom Checkbox (role=checkbox)
                        </div>
                        <div role="slider" tabindex="0" id="aria-slider" class="keyboard-nav-item" aria-valuemin="0"
                            aria-valuemax="100" aria-valuenow="50" aria-label="Volume"
                            style="background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);padding:8px 12px;cursor:pointer"
                            data-testid="aria-slider" onkeydown="handleSliderKey(event)">
                            Volume Slider (role=slider): <strong id="aria-slider-val">50</strong>
                        </div>
                        <div role="progressbar" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100"
                            aria-label="Upload progress"
                            style="background:var(--border);border-radius:6px;height:12px;overflow:hidden"
                            data-testid="aria-progressbar">
                            <div style="width:65%;height:100%;background:var(--primary);border-radius:6px"></div>
                        </div>
                        <span style="font-size:12px;color:var(--text-muted)">Progressbar (65%)</span>
                    </div>
                </div>
                <div>
                    <h3>Structure Roles</h3>
                    <div style="font-size:14px">
                        <div role="list" aria-label="Feature list" data-testid="aria-list">
                            <div role="listitem" style="padding:4px 0;border-bottom:1px solid var(--border)">üìä
                                Analytics Dashboard</div>
                            <div role="listitem" style="padding:4px 0;border-bottom:1px solid var(--border)">üî• Heatmaps
                            </div>
                            <div role="listitem" style="padding:4px 0;border-bottom:1px solid var(--border)">üé¨ Session
                                Recordings</div>
                            <div role="listitem" style="padding:4px 0">üß™ A/B Testing</div>
                        </div>
                        <div role="separator" style="border-top:1px solid var(--border);margin:10px 0"></div>
                        <div role="note"
                            style="background:#fef3c7;border:1px solid #fde68a;border-radius:4px;padding:8px;font-size:13px"
                            data-testid="aria-note">
                            üìù Note: This is a role="note" element.
                        </div>
                        <div role="status" id="aria-status"
                            style="margin-top:8px;font-size:13px;color:var(--text-muted)" data-testid="aria-status">
                            Status: Ready
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ARIA Live Regions -->
        <div class="section" aria-labelledby="live-regions-heading">
            <h2 id="live-regions-heading">ARIA Live Regions</h2>
            <p class="text-sm text-muted" style="margin-bottom:12px">Live regions announce dynamic content changes to
                screen readers.</p>
            <div class="grid-2">
                <div>
                    <h3>aria-live="polite"</h3>
                    <div aria-live="polite" aria-atomic="true" id="live-polite" class="live-region-demo"
                        data-testid="live-polite">
                        Waiting for update‚Ä¶
                    </div>
                    <div class="btn-group mt-8">
                        <button class="btn btn-primary btn-sm"
                            onclick="updateLive('live-polite', 'Polite update: ' + new Date().toLocaleTimeString())"
                            data-testid="live-polite-btn">Update (polite)</button>
                    </div>
                </div>
                <div>
                    <h3>aria-live="assertive"</h3>
                    <div aria-live="assertive" aria-atomic="true" id="live-assertive" class="live-region-demo"
                        role="alert" data-testid="live-assertive">
                        Waiting for urgent update‚Ä¶
                    </div>
                    <div class="btn-group mt-8">
                        <button class="btn btn-danger btn-sm"
                            onclick="updateLive('live-assertive', '‚ö†Ô∏è URGENT: ' + new Date().toLocaleTimeString())"
                            data-testid="live-assertive-btn">Update (assertive)</button>
                    </div>
                </div>
            </div>
            <div class="mt-16">
                <h3>role="log" (append-only)</h3>
                <div role="log" aria-live="polite" aria-label="Activity log" id="aria-log"
                    style="background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);padding:12px;max-height:120px;overflow-y:auto;font-size:13px"
                    data-testid="aria-log">
                    <div>Log initialized.</div>
                </div>
                <button class="btn btn-secondary btn-sm mt-8" onclick="appendLog()" data-testid="aria-log-btn">Append
                    Log Entry</button>
            </div>
        </div>

        <!-- Focus Management -->
        <div class="section" aria-labelledby="focus-heading">
            <h2 id="focus-heading">Focus Management</h2>
            <div class="grid-2">
                <div>
                    <h3>Focus Trap (Modal)</h3>
                    <p class="text-sm text-muted" style="margin-bottom:8px">Tab key stays within the modal when open.
                    </p>
                    <button class="btn btn-primary" id="open-focus-trap" onclick="openFocusTrap()"
                        data-testid="open-focus-trap">Open Focus Trap Modal</button>
                </div>
                <div>
                    <h3>Programmatic Focus</h3>
                    <p class="text-sm text-muted" style="margin-bottom:8px">Move focus to a specific element via
                        JavaScript.</p>
                    <div class="btn-group">
                        <button class="btn btn-secondary btn-sm"
                            onclick="document.getElementById('focus-target-1').focus()" data-testid="focus-to-1">Focus
                            Field 1</button>
                        <button class="btn btn-secondary btn-sm"
                            onclick="document.getElementById('focus-target-2').focus()" data-testid="focus-to-2">Focus
                            Field 2</button>
                        <button class="btn btn-secondary btn-sm"
                            onclick="document.getElementById('focus-target-3').focus()" data-testid="focus-to-3">Focus
                            Button</button>
                    </div>
                    <div class="form-row mt-8">
                        <div class="form-group">
                            <input type="text" id="focus-target-1" placeholder="Field 1" data-testid="focus-target-1">
                        </div>
                        <div class="form-group">
                            <input type="text" id="focus-target-2" placeholder="Field 2" data-testid="focus-target-2">
                        </div>
                        <div class="form-group" style="align-self:flex-end">
                            <button class="btn btn-primary" id="focus-target-3"
                                data-testid="focus-target-3">Button</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Keyboard Navigation -->
        <div class="section" aria-labelledby="keyboard-heading">
            <h2 id="keyboard-heading">Keyboard Navigation</h2>
            <div class="grid-2">
                <div>
                    <h3>Custom Keyboard Widget (Arrow Keys)</h3>
                    <div role="listbox" aria-label="Select a plan" id="listbox-widget" tabindex="0"
                        style="border:1px solid var(--border);border-radius:var(--radius);overflow:hidden"
                        data-testid="listbox-widget" onkeydown="handleListboxKey(event)">
                        <div role="option" aria-selected="true" class="listbox-option" data-val="free"
                            style="padding:10px 14px;background:var(--primary);color:#fff;font-size:14px">Free Plan
                        </div>
                        <div role="option" aria-selected="false" class="listbox-option" data-val="growth"
                            style="padding:10px 14px;font-size:14px;border-top:1px solid var(--border)">Growth Plan
                        </div>
                        <div role="option" aria-selected="false" class="listbox-option" data-val="enterprise"
                            style="padding:10px 14px;font-size:14px;border-top:1px solid var(--border)">Enterprise Plan
                        </div>
                    </div>
                    <div class="form-hint mt-8">Use ‚Üë‚Üì arrow keys to navigate, Enter to select</div>
                    <div id="listbox-selected" class="form-hint">Selected: Free Plan</div>
                </div>
                <div>
                    <h3>Tab Order Demo</h3>
                    <p class="text-sm text-muted" style="margin-bottom:8px">Elements with custom tabindex values.</p>
                    <div style="display:flex;flex-direction:column;gap:8px">
                        <button class="btn btn-secondary btn-sm keyboard-nav-item" tabindex="3"
                            data-testid="taborder-3">tabindex=3 (3rd)</button>
                        <button class="btn btn-secondary btn-sm keyboard-nav-item" tabindex="1"
                            data-testid="taborder-1">tabindex=1 (1st)</button>
                        <button class="btn btn-secondary btn-sm keyboard-nav-item" tabindex="4"
                            data-testid="taborder-4">tabindex=4 (4th)</button>
                        <button class="btn btn-secondary btn-sm keyboard-nav-item" tabindex="2"
                            data-testid="taborder-2">tabindex=2 (2nd)</button>
                        <button class="btn btn-secondary btn-sm keyboard-nav-item" tabindex="-1"
                            data-testid="taborder-neg1">tabindex=-1 (not in tab order)</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ARIA Labels & Descriptions -->
        <div class="section" aria-labelledby="aria-labels-heading">
            <h2 id="aria-labels-heading">ARIA Labels &amp; Descriptions</h2>
            <div class="grid-2">
                <div>
                    <h3>aria-label</h3>
                    <div style="display:flex;flex-direction:column;gap:10px;font-size:14px">
                        <button class="btn btn-danger btn-sm" aria-label="Delete account permanently"
                            data-testid="aria-label-btn">‚úï</button>
                        <input type="search" aria-label="Search products" placeholder="Search‚Ä¶"
                            data-testid="aria-label-input">
                        <div role="img" aria-label="VWO logo placeholder"
                            style="width:60px;height:60px;background:var(--primary);border-radius:8px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:bold"
                            data-testid="aria-label-img">VWO</div>
                    </div>
                </div>
                <div>
                    <h3>aria-describedby &amp; aria-labelledby</h3>
                    <div style="font-size:14px">
                        <div id="group-label" style="font-weight:600;margin-bottom:6px">Notification Preferences</div>
                        <div role="group" aria-labelledby="group-label" data-testid="aria-group">
                            <label style="display:block;margin-bottom:4px"><input type="checkbox"
                                    aria-describedby="email-desc"> Email</label>
                            <div id="email-desc" class="form-hint">Receive updates via email</div>
                            <label style="display:block;margin-bottom:4px;margin-top:8px"><input type="checkbox"
                                    aria-describedby="sms-desc"> SMS</label>
                            <div id="sms-desc" class="form-hint">Receive text message alerts</div>
                        </div>
                        <div style="margin-top:12px">
                            <label for="aria-desc-input" id="aria-desc-label">Username</label>
                            <input type="text" id="aria-desc-input" aria-labelledby="aria-desc-label"
                                aria-describedby="aria-desc-hint aria-desc-error" placeholder="Enter username"
                                style="display:block;width:100%;padding:7px 10px;border:1px solid var(--border);border-radius:var(--radius);font-size:14px;margin-top:4px"
                                data-testid="aria-desc-input">
                            <div id="aria-desc-hint" class="form-hint">3‚Äì20 characters, letters and numbers only</div>
                            <div id="aria-desc-error" role="alert"
                                style="color:var(--danger);font-size:12px;display:none">Username is already taken</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search Landmark -->
        <div class="section">
            <h2>Search Landmark</h2>
            <form role="search" aria-label="Site search" id="a11y-search-form" data-testid="a11y-search">
                <div style="display:flex;gap:8px;max-width:400px">
                    <input type="search" id="a11y-search-input" aria-label="Search the site" placeholder="Search‚Ä¶"
                        style="flex:1;padding:8px 10px;border:1px solid var(--border);border-radius:var(--radius);font-size:14px"
                        data-testid="a11y-search-input">
                    <button type="submit" class="btn btn-primary" aria-label="Submit search"
                        data-testid="a11y-search-submit">Search</button>
                </div>
            </form>
        </div>

        <!-- Expandable / Collapsible -->
        <div class="section" aria-labelledby="expand-heading">
            <h2 id="expand-heading">Expandable Sections (aria-expanded)</h2>
            <div>
                <button class="btn btn-secondary" aria-expanded="false" aria-controls="collapse-1" id="collapse-btn-1"
                    onclick="toggleCollapse('collapse-btn-1','collapse-1')" data-testid="collapse-btn-1">
                    ‚ñ∂ Section 1: What is VWO?
                </button>
                <div id="collapse-1" class="collapsible"
                    style="padding:12px;background:var(--bg);border:1px solid var(--border);border-radius:0 0 var(--radius) var(--radius);font-size:14px">
                    VWO is a comprehensive website optimization platform that helps businesses improve conversion rates.
                </div>
            </div>
            <div style="margin-top:8px">
                <button class="btn btn-secondary" aria-expanded="false" aria-controls="collapse-2" id="collapse-btn-2"
                    onclick="toggleCollapse('collapse-btn-2','collapse-2')" data-testid="collapse-btn-2">
                    ‚ñ∂ Section 2: How does it work?
                </button>
                <div id="collapse-2" class="collapsible"
                    style="padding:12px;background:var(--bg);border:1px solid var(--border);border-radius:0 0 var(--radius) var(--radius);font-size:14px">
                    Install the VWO SmartCode, create experiments, and let VWO handle traffic splitting and statistical
                    analysis.
                </div>
            </div>
        </div>

        <!-- Screen Reader Only Content -->
        <div class="section">
            <h2>Screen Reader Only Content</h2>
            <p class="text-sm text-muted" style="margin-bottom:12px">Content visible only to screen readers using
                <code>.sr-only</code>.</p>
            <table data-testid="a11y-table">
                <caption class="sr-only">User performance data table</caption>
                <thead>
                    <tr>
                        <th scope="col">Name</th>
                        <th scope="col">Score <span class="sr-only">(out of 100)</span></th>
                        <th scope="col">Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Alice</td>
                        <td>92 <span class="sr-only">out of 100</span></td>
                        <td><span class="badge badge-success" aria-label="Status: Active">Active</span></td>
                    </tr>
                    <tr>
                        <td>Bob</td>
                        <td>78 <span class="sr-only">out of 100</span></td>
                        <td><span class="badge badge-danger" aria-label="Status: Inactive">Inactive</span></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- High Contrast Toggle -->
        <div class="section">
            <h2>High Contrast Mode</h2>
            <button class="btn btn-secondary" id="hc-toggle" onclick="toggleHighContrast()"
                data-testid="high-contrast-toggle">Toggle High Contrast</button>
            <p class="form-hint mt-8">Simulates high contrast mode for accessibility testing.</p>
        </div>

    </main>

    <footer role="contentinfo"
        style="background:#1e293b;color:#94a3b8;padding:16px 24px;font-size:13px;margin-top:24px">
        <p>VWO QA Testing Site ‚Äî Non-SPA Website for QA Interns | <a href="index.html" style="color:#60a5fa">Home</a>
        </p>
    </footer>

    <!-- Focus Trap Modal -->
    <div class="focus-trap-overlay" id="focus-trap-overlay" role="dialog" aria-modal="true"
        aria-labelledby="focus-trap-title">
        <div class="focus-trap-box">
            <h3 id="focus-trap-title" style="margin-bottom:12px">Focus Trap Demo</h3>
            <p style="font-size:14px;margin-bottom:16px">Tab key is trapped inside this modal. Press Escape or click
                Close to exit.</p>
            <div class="form-group">
                <label for="trap-input-1">First Name</label>
                <input type="text" id="trap-input-1" placeholder="First name" data-testid="trap-input-1">
            </div>
            <div class="form-group">
                <label for="trap-input-2">Last Name</label>
                <input type="text" id="trap-input-2" placeholder="Last name" data-testid="trap-input-2">
            </div>
            <div class="btn-group">
                <button class="btn btn-primary" id="trap-submit" data-testid="trap-submit">Submit</button>
                <button class="btn btn-secondary" id="trap-close" onclick="closeFocusTrap()"
                    data-testid="trap-close">Close</button>
            </div>
        </div>
    </div>

    <script src="main.js"></script>
    <script>
        // ===== ARIA Button Toggle =====
        function toggleAriaBtn(el) {
            const pressed = el.getAttribute('aria-pressed') === 'true';
            el.setAttribute('aria-pressed', !pressed);
            el.style.background = !pressed ? 'var(--success)' : 'var(--primary)';
            el.textContent = !pressed ? 'Toggled ON (role=button)' : 'Toggle Button (role=button)';
            document.getElementById('aria-status').textContent = 'Status: Button ' + (!pressed ? 'pressed' : 'unpressed');
        }

        // ===== ARIA Checkbox =====
        function toggleAriaCheckbox(el) {
            const checked = el.getAttribute('aria-checked') === 'true';
            el.setAttribute('aria-checked', !checked);
            const icon = document.getElementById('aria-checkbox-icon');
            icon.textContent = !checked ? '‚úì' : '';
            icon.style.background = !checked ? 'var(--primary)' : '';
            icon.style.color = !checked ? '#fff' : '';
            icon.style.borderColor = !checked ? 'var(--primary)' : 'var(--border)';
        }

        // ===== ARIA Slider =====
        function handleSliderKey(e) {
            const slider = document.getElementById('aria-slider');
            let val = parseInt(slider.getAttribute('aria-valuenow'));
            if (e.key === 'ArrowRight' || e.key === 'ArrowUp') val = Math.min(100, val + 5);
            if (e.key === 'ArrowLeft' || e.key === 'ArrowDown') val = Math.max(0, val - 5);
            if (e.key === 'Home') val = 0;
            if (e.key === 'End') val = 100;
            slider.setAttribute('aria-valuenow', val);
            document.getElementById('aria-slider-val').textContent = val;
        }

        // ===== Live Regions =====
        function updateLive(id, msg) {
            document.getElementById(id).textContent = msg;
        }

        let logCount = 0;
        function appendLog() {
            logCount++;
            const log = document.getElementById('aria-log');
            const entry = document.createElement('div');
            entry.textContent = `[${new Date().toLocaleTimeString()}] Log entry #${logCount}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        // ===== Focus Trap =====
        const FOCUSABLE = 'a[href], button:not([disabled]), input:not([disabled]), select, textarea, [tabindex]:not([tabindex="-1"])';

        function openFocusTrap() {
            const overlay = document.getElementById('focus-trap-overlay');
            overlay.classList.add('open');
            document.getElementById('trap-input-1').focus();
            document.addEventListener('keydown', trapKeyHandler);
        }

        function closeFocusTrap() {
            document.getElementById('focus-trap-overlay').classList.remove('open');
            document.removeEventListener('keydown', trapKeyHandler);
            document.getElementById('open-focus-trap').focus();
        }

        function trapKeyHandler(e) {
            if (e.key === 'Escape') { closeFocusTrap(); return; }
            if (e.key !== 'Tab') return;
            const box = document.querySelector('.focus-trap-box');
            const focusable = [...box.querySelectorAll(FOCUSABLE)];
            const first = focusable[0], last = focusable[focusable.length - 1];
            if (e.shiftKey) {
                if (document.activeElement === first) { e.preventDefault(); last.focus(); }
            } else {
                if (document.activeElement === last) { e.preventDefault(); first.focus(); }
            }
        }

        // ===== Listbox keyboard navigation =====
        let listboxIndex = 0;
        function handleListboxKey(e) {
            const options = document.querySelectorAll('.listbox-option');
            if (e.key === 'ArrowDown') { e.preventDefault(); listboxIndex = Math.min(options.length - 1, listboxIndex + 1); }
            if (e.key === 'ArrowUp') { e.preventDefault(); listboxIndex = Math.max(0, listboxIndex - 1); }
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                options.forEach((o, i) => {
                    o.setAttribute('aria-selected', i === listboxIndex);
                    o.style.background = i === listboxIndex ? 'var(--primary)' : '';
                    o.style.color = i === listboxIndex ? '#fff' : '';
                });
                document.getElementById('listbox-selected').textContent = 'Selected: ' + options[listboxIndex].textContent.trim();
                return;
            }
            options.forEach((o, i) => {
                o.style.background = i === listboxIndex ? '#eff6ff' : '';
                o.style.outline = i === listboxIndex ? '2px solid var(--primary)' : '';
            });
        }

        // ===== Collapsible =====
        function toggleCollapse(btnId, contentId) {
            const btn = document.getElementById(btnId);
            const content = document.getElementById(contentId);
            const expanded = btn.getAttribute('aria-expanded') === 'true';
            btn.setAttribute('aria-expanded', !expanded);
            btn.textContent = btn.textContent.replace(expanded ? '‚ñº' : '‚ñ∂', expanded ? '‚ñ∂' : '‚ñº');
        }

        // ===== High Contrast =====
        function toggleHighContrast() {
            document.body.classList.toggle('high-contrast');
        }

        // ===== Search form =====
        document.getElementById('a11y-search-form').addEventListener('submit', function (e) {
            e.preventDefault();
            const q = document.getElementById('a11y-search-input').value;
            alert('Search submitted: ' + q);
        });
    </script>
</body>

</html>